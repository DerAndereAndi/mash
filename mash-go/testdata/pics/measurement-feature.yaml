# PICS (Protocol Implementation Conformance Statement)
# Measurement Feature Capabilities
#
# This file describes the Measurement feature capabilities for test filtering.
# The Measurement feature defines "what the device IS doing" - real-time
# telemetry for power, current, voltage, and energy.

# Device Identification
device:
  vendor: "Reference"
  product: "Measurement Feature PICS"
  model: "N/A"
  version: "1.0.0"

# PICS Items
items:
  # Protocol declaration
  MASH.S: 1

  # Endpoint declaration
  MASH.S.E01: INVERTER             # Reference endpoint for measurement

  # ==========================================================================
  # Feature Presence
  # ==========================================================================

  MASH.S.E01.MEAS: true            # Measurement feature present

  # ==========================================================================
  # AC Power Attributes (Nullable)
  # ==========================================================================

  MASH.S.E01.MEAS.A01: true        # acActivePower (int64, mW, +consumption/-production)
  MASH.S.E01.MEAS.A02: true        # acReactivePower (int64, mVAR)
  MASH.S.E01.MEAS.A03: true        # acApparentPower (uint64, mVA, always positive)
  MASH.S.E01.MEAS.A0A: true        # acActivePowerPerPhase (map[Phase]int64, mW)
  MASH.S.E01.MEAS.A0B: true        # acReactivePowerPerPhase (map[Phase]int64, mVAR)
  MASH.S.E01.MEAS.A0C: true        # acApparentPowerPerPhase (map[Phase]uint64, mVA)

  # ==========================================================================
  # AC Current & Voltage Attributes (Nullable)
  # ==========================================================================

  MASH.S.E01.MEAS.A14: true        # acCurrentPerPhase (map[Phase]int64, mA, signed)
  MASH.S.E01.MEAS.A15: true        # acVoltagePerPhase (map[Phase]uint32, mV)
  MASH.S.E01.MEAS.A16: true        # acVoltagePhaseToPhasePair (map[PhasePair]uint32, mV)
  MASH.S.E01.MEAS.A17: true        # acFrequency (uint32, mHz, e.g., 50000=50.000Hz)
  MASH.S.E01.MEAS.A18: true        # powerFactor (int16, 0.001 units, -1000 to +1000)

  # ==========================================================================
  # AC Energy Attributes (Nullable)
  # ==========================================================================

  MASH.S.E01.MEAS.A1E: true        # acEnergyConsumed (uint64, mWh, monotonic)
  MASH.S.E01.MEAS.A1F: true        # acEnergyProduced (uint64, mWh, monotonic)

  # ==========================================================================
  # DC Measurement Attributes (Nullable)
  # ==========================================================================

  MASH.S.E01.MEAS.A28: true        # dcPower (int64, mW, +into device/-out)
  MASH.S.E01.MEAS.A29: true        # dcCurrent (int64, mA, +into/-out)
  MASH.S.E01.MEAS.A2A: true        # dcVoltage (uint32, mV)
  MASH.S.E01.MEAS.A2B: true        # dcEnergyIn (uint64, mWh)
  MASH.S.E01.MEAS.A2C: true        # dcEnergyOut (uint64, mWh)

  # ==========================================================================
  # Battery State Attributes (Nullable)
  # ==========================================================================

  MASH.S.E01.MEAS.A32: true        # stateOfCharge (uint8, 0-100%)
  MASH.S.E01.MEAS.A33: true        # stateOfHealth (uint8, 0-100%)
  MASH.S.E01.MEAS.A34: true        # stateOfEnergy (uint64, mWh)
  MASH.S.E01.MEAS.A35: true        # useableCapacity (uint64, mWh)
  MASH.S.E01.MEAS.A36: true        # cycleCount (uint32)
  MASH.S.E01.MEAS.A3C: true        # temperature (int16, centi-degrees, e.g., 2500=25.00C)

  # ==========================================================================
  # Behavioral Capabilities
  # ==========================================================================

  # Sign convention: +consumption, -production (passive/load convention)
  MASH.S.E01.MEAS.B_SIGN: true     # Sign convention behavior

  # IsConsuming()/IsProducing() helpers
  MASH.S.E01.MEAS.B_DIRECTION: true  # Direction helper methods

  # Nullable attribute handling
  MASH.S.E01.MEAS.B_NULLABLE: true # Nullable attributes return false when unset

  # Cumulative energy must never decrease
  MASH.S.E01.MEAS.B_CUMULATIVE: true  # Cumulative energy monotonic behavior

# =============================================================================
# Sign Convention
# =============================================================================
# Power values use passive/load convention:
#   - Positive (+) = consumption/charging (power flowing INTO device)
#   - Negative (-) = production/discharging (power flowing OUT OF device)
#
# Current sign follows the same convention.

# =============================================================================
# Test Case to PICS Mapping
# =============================================================================
#
# TC-MEAS-001 (Read AC power positive = consumption):
#   - MASH.S.E01.MEAS.A01: true
#   - MASH.S.E01.MEAS.B_SIGN: true
#
# TC-MEAS-002 (Read AC power negative = production):
#   - MASH.S.E01.MEAS.A01: true
#   - MASH.S.E01.MEAS.B_SIGN: true
#
# TC-MEAS-003 (Per-phase current values):
#   - MASH.S.E01.MEAS.A14: true
#
# TC-MEAS-004 (Nullable attribute returns false when unset):
#   - MASH.S.E01.MEAS.B_NULLABLE: true
#
# TC-MEAS-005 (IsConsuming helper method):
#   - MASH.S.E01.MEAS.B_DIRECTION: true
#
# TC-MEAS-006 (IsProducing helper method):
#   - MASH.S.E01.MEAS.B_DIRECTION: true
#
# TC-MEAS-007 (Cumulative energy never decreases):
#   - MASH.S.E01.MEAS.A1E: true
#   - MASH.S.E01.MEAS.B_CUMULATIVE: true
#
# TC-MEAS-008 (Battery SoC range 0-100):
#   - MASH.S.E01.MEAS.A32: true
#
# TC-MEAS-009 (Power factor bounds):
#   - MASH.S.E01.MEAS.A18: true
#
# TC-MEAS-010 (Subscribe to measurement changes):
#   - MASH.S.E01.MEAS: true
#   - MASH.S.SUB: true
