# PICS (Protocol Implementation Conformance Statement)
# Common Protocol Capabilities
#
# This file is the single source of truth for protocol-level PICS items that
# are true for any conformant MASH implementation. Auto-PICS loads this as its
# base and merges device-specific discovered items (endpoints, features,
# attributes, use cases) on top.
#
# Device profiles (like ev-charger.yaml) describe device-specific features;
# this file covers the protocol layer.

# Device Identification (overridden by auto-PICS when present)
device:
  vendor: "Reference"
  product: "Protocol Common"
  model: "N/A"
  version: "1.0.0"

# PICS Items
items:
  # Protocol declarations (this file has both server and controller items)
  MASH.S: 1
  MASH.C: 1

  # ==========================================================================
  # Core Features (always present)
  # ==========================================================================

  MASH.S.INFO: true                         # DeviceInfo feature on endpoint 0
  MASH.S.COMM: true                         # Device supports commissioning

  # ==========================================================================
  # Transport Layer
  # ==========================================================================

  MASH.S.TRANS.SC: true                     # Secure connection
  MASH.S.TRANS.TLS13: true                  # TLS 1.3
  MASH.S.TRANS.PASE: true                   # PASE commissioning
  MASH.S.TRANS.MAX_CONNECTIONS: 5           # Max simultaneous connections
  MASH.S.TRANS.B_MULTI_ZONE_CONN: 1        # Multi-zone connection support
  MASH.S.TRANS.B_QUEUE_ON_RECONNECT: 1     # Queue messages on reconnect
  MASH.S.TRANS.B_SUBSCRIPTION_LOST: 1      # Subscription lost notification
  MASH.S.TRANS.PING_INTERVAL: 30           # Ping interval (seconds)
  MASH.S.TRANS.PONG_TIMEOUT: 5             # Pong timeout (seconds)
  MASH.S.TRANS.MISSED_PONGS_CLOSE: 3       # Close after N missed pongs
  MASH.S.TRANS.CLOSE_ACK_TIMEOUT: 5        # Close ack timeout (seconds)
  MASH.S.TRANS.CLOSE_PENDING_TIMEOUT: 10   # Close pending timeout (seconds)
  MASH.S.TRANS.RECONNECT_AFTER_COMM: 1     # Reconnect after commissioning

  # ==========================================================================
  # TLS Configuration
  # ==========================================================================

  MASH.S.TLS.VERSION: 1.3                  # TLS version
  MASH.S.TLS.ALPN: mash/1                  # ALPN protocol
  MASH.S.TLS.CS_AES_128_GCM: 1            # AES-128-GCM cipher suite
  MASH.S.TLS.CS_AES_256_GCM: 1            # AES-256-GCM cipher suite
  MASH.S.TLS.KX_X25519: 1                 # X25519 key exchange
  MASH.S.TLS.KX_P256: 1                   # P-256 key exchange
  MASH.S.TLS.EXT_ALPN: 1                  # ALPN extension
  MASH.S.TLS.EXT_EARLY_DATA: 0            # No early data (0-RTT)
  MASH.S.TLS.EXT_SESSION_TICKET: 0        # No session tickets
  MASH.S.TLS.FALLBACK_DISABLED: 1         # No fallback to older TLS
  MASH.S.TLS.MUTUAL_AUTH: 1               # Mutual TLS authentication
  MASH.S.TLS.MUTUAL_AUTH_OPERATIONAL: 1   # Mutual auth for operational
  MASH.S.TLS.SELF_SIGNED_COMM: 1          # Self-signed for commissioning
  MASH.S.TLS.SELF_SIGNED_COMMISSIONING: 1 # (alias)
  MASH.S.TLS.CERT_CHAIN_MAX_DEPTH: 2      # Max cert chain depth

  # ==========================================================================
  # Discovery (mDNS)
  # ==========================================================================

  MASH.S.DISC.SVC_COMMISSION: _mashc._udp     # Commissioning service type
  MASH.S.DISC.SVC_OPERATIONAL: _mash._tcp      # Operational service type
  MASH.S.DISC.SVC_COMMISSIONER: _mashd._udp    # Commissioner service type
  MASH.S.DISC.BROWSE_TIMEOUT: 10               # Browse timeout (seconds)
  MASH.S.DISC.COMMISSION_WINDOW: 120           # Commission window (seconds)
  MASH.S.DISC.DISCRIMINATOR_BITS: 12           # Discriminator bit length
  MASH.S.DISC.QR_VERSION: 1                    # QR code version
  MASH.S.DISC.COMM_TXT_D: 1                    # Commissionable TXT: discriminator
  MASH.S.DISC.COMM_TXT_CAT: 1                  # Commissionable TXT: category
  MASH.S.DISC.COMM_TXT_BRAND: 1                # Commissionable TXT: brand
  MASH.S.DISC.COMM_TXT_MODEL: 1                # Commissionable TXT: model
  MASH.S.DISC.COMM_TXT_SERIAL: 1               # Commissionable TXT: serial
  MASH.S.DISC.OPER_TXT_DI: 1                   # Operational TXT: device ID
  MASH.S.DISC.OPER_TXT_ZI: 1                   # Operational TXT: zone ID
  MASH.S.DISC.PAIRING_REQUEST: true             # Device listens for pairing requests
  MASH.S.DISC.PAIRING_DISCRIMINATOR: true       # Device matches by discriminator

  # ==========================================================================
  # Framing
  # ==========================================================================

  MASH.S.FRAME.LENGTH_BYTES: 4             # Frame length field size
  MASH.S.FRAME.MAX_SIZE: 65536             # Max frame size (bytes)

  # ==========================================================================
  # CBOR Serialization
  # ==========================================================================

  MASH.S.CBOR.DUPLICATE_KEYS_ERROR: 1      # Reject duplicate CBOR keys
  MASH.S.CBOR.FLOAT64_ONLY: 1              # Only float64 (no float16/32)
  MASH.S.CBOR.IGNORE_UNKNOWN_KEYS: 1       # Ignore unknown CBOR keys
  MASH.S.CBOR.KEY_ORDER_REQUIRED: 0        # Key ordering not required

  # ==========================================================================
  # Protocol Behaviors
  # ==========================================================================

  MASH.S.PROTO.AUTO_PONG: true             # Automatic pong response
  MASH.S.PROTO.CORRELATION: true           # Message correlation (request/response)
  MASH.S.PROTO.KEEPALIVE: true             # Keepalive ping/pong
  MASH.S.PROTO.PRIMING: true               # Initial state priming after subscribe
  MASH.S.PROTO.REQUEST_TIMEOUT: true       # Request timeout enforcement
  MASH.S.PROTO.SUBSCRIPTION: true          # Subscription support

  # ==========================================================================
  # Integer Handling
  # ==========================================================================

  MASH.S.INT.MAX_INT64: 1                  # Support int64 values

  # ==========================================================================
  # IPv6
  # ==========================================================================

  MASH.S.IPV6.LINK_LOCAL_INTERFACE: 1      # Link-local interface support
  MASH.S.IPV6.ADDRESS_CHANGE: 1            # Address change handling

  # ==========================================================================
  # mDNS Infrastructure
  # ==========================================================================

  MASH.S.MDNS.LINK_LOCAL: 1               # mDNS on link-local
  MASH.S.MDNS.SRV_RECORD: 1               # SRV record support
  MASH.S.MDNS.AAAA_RECORD: 1              # AAAA record support
  MASH.S.MDNS.GLOBAL_ADDR: 1              # Global address in mDNS

  # ==========================================================================
  # Multi-Interface
  # ==========================================================================

  MASH.S.MULTIIF.SUPPORTED: 1             # Multi-interface support
  MASH.S.MULTIIF.PUBLISH_ALL: 1           # Publish on all interfaces
  MASH.S.MULTIIF.DEBOUNCE_MS: 2000        # Address change debounce (ms)

  # ==========================================================================
  # Subscriptions
  # ==========================================================================

  MASH.S.SUB: true                         # Subscription support
  MASH.S.SUB.B_COALESCE: true             # Coalesced notifications
  MASH.S.SUB.B_HEARTBEAT_CONTENT: true    # Heartbeat with content

  # ==========================================================================
  # Commissioning
  # ==========================================================================

  MASH.S.COMM.PAIRING_REQUEST: true        # Device opens window on pairing request
  MASH.S.COMM.HARDENING: true              # Device implements DEC-047 hardening
  MASH.S.COMM.MAX_COMMISSIONING_CONN: 1    # Max concurrent commissioning (always 1)
  MASH.S.COMM.CONN_COOLDOWN: 500           # Milliseconds between completed attempts (DEC-065: starts at release)
  MASH.S.COMM.HANDSHAKE_TIMEOUT: 85        # Overall handshake timeout (seconds)
  MASH.S.COMM.BACKOFF_ENABLED: true        # PASE attempt backoff enabled
  MASH.S.COMM.BACKOFF_TIER1: 0             # Delay for attempts 1-3 (ms)
  MASH.S.COMM.BACKOFF_TIER2: 1000          # Delay for attempts 4-6 (ms)
  MASH.S.COMM.BACKOFF_TIER3: 3000          # Delay for attempts 7-10 (ms)
  MASH.S.COMM.BACKOFF_TIER4: 10000         # Delay for attempts 11+ (ms)
  MASH.S.COMM.GENERIC_ERRORS: true         # Generic error responses (DEC-047)
  MASH.S.COMM.ERROR_DELAY_MIN: 100         # Minimum error delay (ms)
  MASH.S.COMM.ERROR_DELAY_MAX: 500         # Maximum error delay (ms)
  MASH.S.COMM.WINDOW_DEFAULT: 900          # Default window duration (seconds) - 15 min
  MASH.S.COMM.WINDOW_MIN: 180              # Minimum window (seconds) - 3 min
  MASH.S.COMM.WINDOW_MAX: 10800            # Maximum window (seconds) - 3 hours
  MASH.S.COMM.WINDOW_CONFIGURABLE: true    # Device supports configurable window

  # ==========================================================================
  # Certificate Management (Device-Side)
  # ==========================================================================

  MASH.S.CERT.EXCHANGE: true               # Device supports cert exchange after PASE
  MASH.S.CERT.DEVICE_ID_FROM_CN: true      # Device extracts device ID from cert CN
  MASH.S.CERT.RENEWAL: true                # Device supports certificate renewal
  MASH.S.CERT.IN_SESSION_RENEWAL: true     # Renewal without TLS reconnection
  MASH.S.CERT.NONCE_BINDING: true          # Nonce-to-CSR binding enforced
  MASH.S.CERT.EXPIRY_HANDLING: true        # Proper handling of expired certificates
  MASH.S.CERT.GRACE_PERIOD: 7             # Days to accept connections after expiry
  MASH.S.EVENT.CERT_EXPIRING: true         # Sends notification when cert near expiry

  # ==========================================================================
  # Certificate Management (Controller-Side)
  # ==========================================================================

  MASH.C.CERT.ZONE_CA: true               # Controller has Zone CA for signing
  MASH.C.CERT.RENEWAL_INITIATE: true       # Controller can initiate renewal
  MASH.C.CERT.AUTO_RENEWAL: false          # Automatic renewal (optional)

  # ==========================================================================
  # Connection Management
  # ==========================================================================

  MASH.S.TRANS.CONN_CAP: true              # Transport-level connection cap (DEC-062)
  MASH.S.COMM.ERR_BUSY: true              # Busy rejection (DEC-063)
  MASH.S.COMM.ERR_BUSY_RETRY_AFTER: true  # Busy response includes RetryAfter
  MASH.S.CONN.STALE_REAPER: true          # Stale connection reaper (DEC-064)
  MASH.S.CONN.STALE_TIMEOUT: 90           # Stale timeout (seconds)

  # ==========================================================================
  # Zone Management
  # ==========================================================================

  MASH.S.ZONE: true                        # Zone support
  MASH.S.ZONE.MAX: 3                       # Max zones (GRID + LOCAL + TEST, DEC-060)
  MASH.S.ZONE.MULTI: true                  # Multiple zone support
  MASH.S.ZONE.ADD: true                    # Zone addition
  MASH.S.ZONE.CONNECT: true               # Zone connection
  MASH.S.ZONE.REMOVE: true                # Zone removal
  MASH.S.ZONE.GRID: true                  # GRID zone type
  MASH.S.ZONE.LOCAL: true                 # LOCAL zone type
  MASH.S.ZONE.B_PRIORITY: true            # Zone priority
  MASH.S.ZONE.B_RECOMM: true              # Zone recommissioning
  MASH.S.ZONE.B_RESTRICT: true            # Most-restrictive-wins for limits
  MASH.S.ZONE.LAST_SEEN: true             # Zone last-seen tracking

  # ==========================================================================
  # Controller Capabilities
  # ==========================================================================

  MASH.C.DISC.PAIRING_REQUEST: true        # Controller can announce pairing requests
  MASH.C.DISC.COMMR_TXT_DC: 1             # Commissioner TXT: discriminator
  MASH.C.DISC.COMMR_TXT_ZI: 1             # Commissioner TXT: zone ID
  MASH.C.DISC.COMMR_TXT_ZN: 1             # Commissioner TXT: zone name
  MASH.C.ZONE.CREATE: true                # Controller can create zones
  MASH.C.PROTO.RECONNECT: true            # Controller reconnection support
  MASH.C.CERT.AUTO: true                  # Auto certificate management
  MASH.C.CERT.PERSIST: true               # Certificate persistence
  MASH.C.CERT.RENEW: true                 # Certificate renewal
  MASH.C.TRANS.BACKOFF_INITIAL: 1          # Initial backoff (seconds)
  MASH.C.TRANS.BACKOFF_MAX: 60            # Max backoff (seconds)
  MASH.C.TRANS.BACKOFF_JITTER: 10         # Backoff jitter (percent)
  MASH.C.MULTIIF.TRY_ALL: 1              # Try all interfaces
  MASH.C.MULTIIF.TIMEOUT_PER_ADDR: 5000  # Timeout per address (ms)
  MASH.C.MULTIIF.CACHE_LAST_GOOD: 1      # Cache last good address

  # ==========================================================================
  # Device Capability Flags (D.* prefix)
  # Inferred from protocol conformance -- true for any conformant device.
  # ==========================================================================

  D.COMM.PASE: true                        # Device supports PASE
  D.COMM.SC: true                          # Device supports secure connection
  D.COMM.TLS13: true                       # Device supports TLS 1.3
  D.COMM.QR: true                          # Device supports QR code provisioning
  D.COMM.DISPLAY: true                     # Device supports display (QR/setup code)
  D.COMM.ADMIN: true                       # Device supports admin commissioning
  D.DISC.MDNS: true                        # Device supports mDNS discovery
  D.DISC.COMM: true                        # Device supports commissionable discovery
  D.DISC.OP: true                          # Device supports operational discovery
  D.INFO.BASIC: true                       # Device supports basic device info
  D.CERT.EXCHANGE: true                    # Device supports cert exchange
  D.CERT.CHAIN: true                       # Device supports cert chain
  D.CERT.MUTUAL: true                      # Device supports mutual TLS
  D.CERT.RENEWAL: true                     # Device supports cert renewal
  D.CERT.IN_SESSION_RENEWAL: true          # Device supports in-session renewal
  D.CERT.D2D: true                         # Device supports device-to-device
  D.CERT.EXPIRY_HANDLING: true             # Device enforces cert expiry
  D.CERT.GRACE_PERIOD: true               # Device supports grace period
  D.EVENT.CERT_EXPIRING: true              # Device sends cert expiry events
  D.ZONE.MULTI: true                       # Device supports multiple zones
  D.BIDIR.READ: true                       # Device supports reading from controller
  D.BIDIR.SUBSCRIBE: true                  # Device supports subscribing to controller
  C.BIDIR.EXPOSE: true                     # Controller supports exposing features
  C.CERT.ZONE_CA: true                    # Controller has Zone CA capability

  # ==========================================================================
  # Status Feature (always available as protocol-level)
  # ==========================================================================

  MASH.S.STATUS.STATE_DETAIL: true         # Status state detail support
