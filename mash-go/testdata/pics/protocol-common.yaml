# PICS (Protocol Implementation Conformance Statement)
# Common Protocol Capabilities
#
# This file describes protocol-level capabilities that are not
# specific to any device type. Device profiles (like ev-charger.yaml)
# describe device-specific features; this file covers the protocol layer.

# Device Identification
device:
  vendor: "Reference"
  product: "Protocol Common"
  model: "N/A"
  version: "1.0.0"

# PICS Items
items:
  # Protocol declarations (this file has both server and controller items)
  MASH.S: 1
  MASH.C: 1

  # ==========================================================================
  # Certificate Management (Device-Side)
  # ==========================================================================

  MASH.S.CERT.EXCHANGE: true          # Device supports cert exchange after PASE
  MASH.S.CERT.DEVICE_ID_FROM_CN: true # Device extracts device ID from cert CommonName
  MASH.S.CERT.RENEWAL: true           # Device supports certificate renewal
  MASH.S.CERT.IN_SESSION_RENEWAL: true # Renewal without TLS reconnection
  MASH.S.CERT.EXPIRY_HANDLING: true   # Proper handling of expired certificates
  MASH.S.CERT.GRACE_PERIOD: 7         # Days to accept connections after expiry
  MASH.S.EVENT.CERT_EXPIRING: true    # Sends notification when cert near expiry

  # ==========================================================================
  # Certificate Management (Controller-Side)
  # ==========================================================================

  MASH.C.CERT.ZONE_CA: true           # Controller has Zone CA for signing
  MASH.C.CERT.RENEWAL_INITIATE: true  # Controller can initiate renewal
  MASH.C.CERT.AUTO_RENEWAL: false     # Automatic renewal (optional)

  # ==========================================================================
  # Pairing Request Mechanism (DEC-042)
  # ==========================================================================

  MASH.S.DISC.PAIRING_REQUEST: true    # Device listens for pairing requests (_mashp._udp)
  MASH.S.COMM.PAIRING_REQUEST: true    # Device opens window on matching pairing request
  MASH.S.DISC.PAIRING_DISCRIMINATOR: true  # Device matches by discriminator

  # ==========================================================================
  # Controller Pairing Request
  # ==========================================================================

  MASH.C.DISC.PAIRING_REQUEST: true    # Controller can announce pairing requests

  # ==========================================================================
  # Security Hardening (DEC-047)
  # ==========================================================================

  MASH.S.COMM.HARDENING: true              # Device implements DEC-047 hardening

  # Connection Model (derived from zone capacity)
  MASH.S.COMM.MAX_COMMISSIONING_CONN: 1    # Max concurrent commissioning (always 1)
  MASH.S.COMM.CONN_COOLDOWN: 500           # Milliseconds between connections
  MASH.S.COMM.HANDSHAKE_TIMEOUT: 85        # Overall handshake timeout (seconds)
  # Note: Max operational connections = MASH.S.ZONE.MAX (one per zone)
  # Total max connections = MASH.S.ZONE.MAX + 1

  # PASE Backoff
  MASH.S.COMM.BACKOFF_ENABLED: true        # PASE attempt backoff enabled
  MASH.S.COMM.BACKOFF_TIER1: 0             # Delay for attempts 1-3 (ms)
  MASH.S.COMM.BACKOFF_TIER2: 1000          # Delay for attempts 4-6 (ms)
  MASH.S.COMM.BACKOFF_TIER3: 3000          # Delay for attempts 7-10 (ms)
  MASH.S.COMM.BACKOFF_TIER4: 10000         # Delay for attempts 11+ (ms)

  # Certificate Renewal
  MASH.S.CERT.NONCE_BINDING: true          # Nonce-to-CSR binding enforced

  # Error Handling
  MASH.S.COMM.GENERIC_ERRORS: true         # Generic error responses (DEC-047)
  MASH.S.COMM.ERROR_DELAY_MIN: 100         # Minimum error delay (ms)
  MASH.S.COMM.ERROR_DELAY_MAX: 500         # Maximum error delay (ms)

  # Zone configuration (existing, but needed for connection model)
  MASH.S.ZONE.MAX: 2                       # Maximum zones (GRID + LOCAL)

# =============================================================================
# Test Case to PICS Mapping
# =============================================================================
#
# TC-CERT-RENEW-1 (Normal Renewal):
#   - MASH.S.CERT.RENEWAL: true
#   - MASH.C.CERT.ZONE_CA: true
#
# TC-CERT-RENEW-2 (Session Continuity):
#   - MASH.S.CERT.IN_SESSION_RENEWAL: true
#
# TC-CERT-RENEW-3 (Expiry Warning):
#   - MASH.S.EVENT.CERT_EXPIRING: true
#
# TC-CERT-RENEW-4 (Expired Certificate):
#   - MASH.S.CERT.EXPIRY_HANDLING: true
#   - MASH.S.CERT.GRACE_PERIOD: 0
#
# TC-CERT-RENEW-5 (Grace Period):
#   - MASH.S.CERT.GRACE_PERIOD: > 0
#
# =============================================================================
# Pairing Request Tests (DEC-042)
# =============================================================================
#
# TC-PAIR-001 (Device Opens Window on Pairing Request):
#   - MASH.S.DISC.PAIRING_REQUEST: true
#   - MASH.S.COMM.PAIRING_REQUEST: true
#
# TC-PAIR-002 (Device Ignores Mismatched Discriminator):
#   - MASH.S.DISC.PAIRING_REQUEST: true
#   - MASH.S.DISC.PAIRING_DISCRIMINATOR: true
#
# TC-PAIR-003 (Rate Limiting - Window Already Open):
#   - MASH.S.DISC.PAIRING_REQUEST: true
#   - MASH.S.COMM.PAIRING_REQUEST: true
#
# TC-PAIR-004 (Deferred Commissioning Flow):
#   - MASH.S.DISC.PAIRING_REQUEST: true
#   - MASH.S.COMM.PAIRING_REQUEST: true
#   - MASH.S.TRANS.PASE: true
#
# TC-PAIR-005 (Commissioned Device Ignores Pairing Requests):
#   - MASH.S.DISC.PAIRING_REQUEST: true
#   - MASH.S.ZONE.MAX: 2
#
# =============================================================================
# Commissioning Certificate Exchange Tests
# =============================================================================
#
# TC-COMM-002 (Certificate Exchange After PASE):
#   - MASH.S.CERT.EXCHANGE: true
#   - MASH.S.CERT.DEVICE_ID_FROM_CN: true
#   - MASH.C.CERT.ZONE_CA: true
#
# TC-COMM-003 (Device ID Consistency):
#   - MASH.S.CERT.DEVICE_ID_FROM_CN: true
#   - MASH.S.DISC.OP: true
#
# TC-COMM-004 (Multi-Zone Different Device IDs):
#   - MASH.S.CERT.EXCHANGE: true
#   - MASH.S.ZONE.MAX: 2
#
# =============================================================================
# Security Hardening Tests (DEC-047)
# =============================================================================
#
# TC-SEC-CONN-001 (Single Commissioning Connection Limit):
#   - MASH.S.COMM.HARDENING: true
#
# TC-SEC-CONN-002 (Commissioning Blocked When Zones Full):
#   - MASH.S.COMM.HARDENING: true
#   - MASH.S.ZONE.MAX: 2
#
# TC-SEC-CONN-003 (Operational Connections During Commissioning):
#   - MASH.S.COMM.HARDENING: true
#   - MASH.S.ZONE.MAX: 2
#
# TC-SEC-CONN-004 (Overall Handshake Timeout):
#   - MASH.S.COMM.HARDENING: true
#   - MASH.S.COMM.HANDSHAKE_TIMEOUT: 85
#
# TC-SEC-CONN-005 (Flood Resistance):
#   - MASH.S.COMM.HARDENING: true
#   - MASH.S.ZONE.MAX: 2
#
# TC-SEC-BACKOFF-001 (PASE Backoff Tier Enforcement):
#   - MASH.S.COMM.BACKOFF_ENABLED: true
#   - MASH.S.COMM.BACKOFF_TIER2: 1000
#   - MASH.S.COMM.BACKOFF_TIER3: 3000
#
# TC-SEC-BACKOFF-002 (Backoff Reset on Window Close):
#   - MASH.S.COMM.BACKOFF_ENABLED: true
#
# TC-SEC-BACKOFF-003 (Backoff Reset on Success):
#   - MASH.S.COMM.BACKOFF_ENABLED: true
#   - MASH.S.ZONE.MAX: 2
#
# TC-SEC-NONCE-001 (Nonce Binding in CSR):
#   - MASH.S.CERT.NONCE_BINDING: true
#   - MASH.S.CERT.IN_SESSION_RENEWAL: true
#
# TC-SEC-NONCE-002 (Nonce Mismatch Rejection):
#   - MASH.S.CERT.NONCE_BINDING: true
#   - MASH.S.CERT.IN_SESSION_RENEWAL: true
#
# TC-SEC-ERR-001 (Generic Error Response):
#   - MASH.S.COMM.GENERIC_ERRORS: true
#
# TC-SEC-ERR-002 (Error Response Timing Consistency):
#   - MASH.S.COMM.GENERIC_ERRORS: true
#   - MASH.S.COMM.ERROR_DELAY_MIN: 100
#   - MASH.S.COMM.ERROR_DELAY_MAX: 500
