# PICS (Protocol Implementation Conformance Statement)
# EnergyControl Feature Capabilities
#
# This file describes the EnergyControl feature capabilities for test filtering.
# The EnergyControl feature defines "what the device SHOULD do" - limits,
# setpoints, and process control.

# Device Identification
device:
  vendor: "Reference"
  product: "EnergyControl Feature PICS"
  model: "N/A"
  version: "1.0.0"

# PICS Items
items:
  # Protocol declaration
  MASH.S: 1

  # Endpoint declaration
  MASH.S.E01: EV_CHARGER           # Reference endpoint for energy control

  # ==========================================================================
  # Feature Presence
  # ==========================================================================

  MASH.S.E01.CTRL: true            # EnergyControl feature present

  # ==========================================================================
  # Feature Flags (FeatureMap bits)
  # ==========================================================================

  MASH.S.E01.CTRL.F00: true        # CORE - Always required
  MASH.S.E01.CTRL.F01: false       # FLEX - Flexibility (not implemented)
  MASH.S.E01.CTRL.F02: false       # BATTERY - Battery-specific (via device type)
  MASH.S.E01.CTRL.F03: false       # EMOB - Electric mobility (requires CHRG)
  MASH.S.E01.CTRL.F04: false       # SIGNALS - Time-slotted signals (not implemented)
  MASH.S.E01.CTRL.F05: false       # TARIFF - Price structures (not implemented)
  MASH.S.E01.CTRL.F06: false       # PLAN - Device scheduling (not implemented)
  MASH.S.E01.CTRL.F07: false       # PROCESS - Process management
  MASH.S.E01.CTRL.F08: false       # FORECAST - Forecast data (not implemented)
  MASH.S.E01.CTRL.F09: false       # ASYMMETRIC - Per-phase control
  MASH.S.E01.CTRL.F0A: false       # V2X - Vehicle-to-everything

  # ==========================================================================
  # Device Type & State Attributes (Mandatory)
  # ==========================================================================

  MASH.S.E01.CTRL.A01: true        # deviceType (DeviceType enum)
  MASH.S.E01.CTRL.A02: true        # controlState (ControlState enum)
  MASH.S.E01.CTRL.A03: true        # optOutState (OptOutState enum)

  # ==========================================================================
  # Control Capabilities (Mandatory, Boolean)
  # ==========================================================================

  MASH.S.E01.CTRL.A0A: true        # acceptsLimits
  MASH.S.E01.CTRL.A0B: true        # acceptsCurrentLimits
  MASH.S.E01.CTRL.A0C: true        # acceptsSetpoints
  MASH.S.E01.CTRL.A0D: false       # acceptsCurrentSetpoints (requires V2X)
  MASH.S.E01.CTRL.A0E: true        # isPausable
  MASH.S.E01.CTRL.A0F: false       # isShiftable (requires FLEX)
  MASH.S.E01.CTRL.A10: false       # isStoppable (requires PROCESS)

  # ==========================================================================
  # Power Limit Attributes (Nullable, mW)
  # ==========================================================================

  MASH.S.E01.CTRL.A14: true        # effectiveConsumptionLimit (multi-zone resolved)
  MASH.S.E01.CTRL.A15: true        # myConsumptionLimit (this zone's limit)
  MASH.S.E01.CTRL.A16: false       # effectiveProductionLimit (requires BIDIRECTIONAL)
  MASH.S.E01.CTRL.A17: false       # myProductionLimit (requires BIDIRECTIONAL)

  # ==========================================================================
  # Per-Phase Current Limit Attributes (Nullable, mA, requires ASYMMETRIC)
  # ==========================================================================

  MASH.S.E01.CTRL.A1E: false       # effectiveCurrentLimitsConsumption
  MASH.S.E01.CTRL.A1F: false       # myCurrentLimitsConsumption
  MASH.S.E01.CTRL.A20: false       # effectiveCurrentLimitsProduction
  MASH.S.E01.CTRL.A21: false       # myCurrentLimitsProduction

  # ==========================================================================
  # Power Setpoint Attributes (Nullable, mW)
  # ==========================================================================

  MASH.S.E01.CTRL.A28: true        # effectiveConsumptionSetpoint
  MASH.S.E01.CTRL.A29: true        # myConsumptionSetpoint
  MASH.S.E01.CTRL.A2A: false       # effectiveProductionSetpoint (requires BIDIRECTIONAL)
  MASH.S.E01.CTRL.A2B: false       # myProductionSetpoint (requires BIDIRECTIONAL)

  # ==========================================================================
  # Per-Phase Current Setpoint Attributes (Nullable, mA, requires V2X)
  # ==========================================================================

  MASH.S.E01.CTRL.A32: false       # effectiveCurrentSetpointsConsumption
  MASH.S.E01.CTRL.A33: false       # myCurrentSetpointsConsumption
  MASH.S.E01.CTRL.A34: false       # effectiveCurrentSetpointsProduction
  MASH.S.E01.CTRL.A35: false       # myCurrentSetpointsProduction

  # ==========================================================================
  # Flexibility Attributes (requires FLEX)
  # ==========================================================================

  MASH.S.E01.CTRL.A3C: false       # flexibility

  # ==========================================================================
  # Forecast Attributes (requires FORECAST)
  # ==========================================================================

  MASH.S.E01.CTRL.A3D: false       # forecast

  # ==========================================================================
  # Failsafe Attributes (Mandatory)
  # ==========================================================================

  MASH.S.E01.CTRL.A46: true        # failsafeConsumptionLimit (mW)
  MASH.S.E01.CTRL.A47: false       # failsafeProductionLimit (requires BIDIRECTIONAL)
  MASH.S.E01.CTRL.A48: true        # failsafeDuration (seconds, default 7200)

  # ==========================================================================
  # Contractual Limits (EMS/CEM only - LPC/LPP support)
  # ==========================================================================

  MASH.S.E01.CTRL.A49: false       # contractualConsumptionMax (EMS only)
  MASH.S.E01.CTRL.A4A: false       # contractualProductionMax (EMS only)

  # ==========================================================================
  # Override Tracking (LPC/LPP support)
  # ==========================================================================

  MASH.S.E01.CTRL.A4B: true        # overrideReason (set when in OVERRIDE)
  MASH.S.E01.CTRL.A4C: true        # overrideDirection

  # ==========================================================================
  # Process Attributes (requires PROCESS)
  # ==========================================================================

  MASH.S.E01.CTRL.A50: false       # processState
  MASH.S.E01.CTRL.A51: false       # optionalProcess

  # ==========================================================================
  # Commands
  # ==========================================================================

  # Power Limits
  MASH.S.E01.CTRL.C01.Rsp: true    # SetLimit
  MASH.S.E01.CTRL.C02.Rsp: true    # ClearLimit

  # Current Limits
  MASH.S.E01.CTRL.C03.Rsp: true    # SetCurrentLimits
  MASH.S.E01.CTRL.C04.Rsp: true    # ClearCurrentLimits

  # Power Setpoints
  MASH.S.E01.CTRL.C05.Rsp: true    # SetSetpoint
  MASH.S.E01.CTRL.C06.Rsp: true    # ClearSetpoint

  # Current Setpoints (requires V2X)
  MASH.S.E01.CTRL.C07.Rsp: false   # SetCurrentSetpoints
  MASH.S.E01.CTRL.C08.Rsp: false   # ClearCurrentSetpoints

  # Process Control
  MASH.S.E01.CTRL.C09.Rsp: true    # Pause
  MASH.S.E01.CTRL.C0A.Rsp: true    # Resume
  MASH.S.E01.CTRL.C0B.Rsp: false   # Stop (requires PROCESS)
  MASH.S.E01.CTRL.C0C.Rsp: false   # ScheduleProcess (requires PROCESS)
  MASH.S.E01.CTRL.C0D.Rsp: false   # CancelProcess (requires PROCESS)
  MASH.S.E01.CTRL.C0E.Rsp: false   # AdjustStartTime (requires isShiftable)

  # ==========================================================================
  # Behavioral Capabilities
  # ==========================================================================

  # Multi-zone resolution: most restrictive wins for limits
  MASH.S.E01.CTRL.B_MULTIZONE: true  # Multi-zone value resolution

  # Duration parameter causes value expiry
  MASH.S.E01.CTRL.B_DURATION: true # Duration-based expiry

  # Effective vs own value separation
  MASH.S.E01.CTRL.B_EFFECTIVE: true  # Effective/own value split

  # OptOut states filter commands
  MASH.S.E01.CTRL.B_OPTOUT: true   # OptOut state filtering

  # ==========================================================================
  # LPC/LPP Behavioral Capabilities
  # ==========================================================================

  # SetLimit enhanced response fields
  MASH.S.E01.CTRL.B_APPLIED: true  # SetLimit returns 'applied' field
  MASH.S.E01.CTRL.B_REJECT: true   # SetLimit returns 'rejectReason' field
  MASH.S.E01.CTRL.B_CTRLSTATE: true  # SetLimit returns 'controlState' field

  # Limit validation behaviors
  MASH.S.E01.CTRL.B_VALIDATE_NEG: true  # Rejects negative limit values
  MASH.S.E01.CTRL.B_VALIDATE_MIN: true  # Checks against minimum operating power
