// Code generated by mash-featgen. DO NOT EDIT.

package features

import (
	"context"

	"github.com/mash-protocol/mash-go/pkg/model"
	"github.com/mash-protocol/mash-go/pkg/wire"
)

// ChargingSession attribute IDs.
const (
	ChargingSessionAttrState                           uint16 = 1
	ChargingSessionAttrSessionID                       uint16 = 2
	ChargingSessionAttrSessionStartTime                uint16 = 3
	ChargingSessionAttrSessionEndTime                  uint16 = 4
	ChargingSessionAttrSessionEnergyCharged            uint16 = 10
	ChargingSessionAttrSessionEnergyDischarged         uint16 = 11
	ChargingSessionAttrEVIdentifications               uint16 = 20
	ChargingSessionAttrEVStateOfCharge                 uint16 = 30
	ChargingSessionAttrEVBatteryCapacity               uint16 = 31
	ChargingSessionAttrEVMinStateOfCharge              uint16 = 32
	ChargingSessionAttrEVTargetStateOfCharge           uint16 = 33
	ChargingSessionAttrEVDemandMode                    uint16 = 40
	ChargingSessionAttrEVMinEnergyRequest              uint16 = 41
	ChargingSessionAttrEVMaxEnergyRequest              uint16 = 42
	ChargingSessionAttrEVTargetEnergyRequest           uint16 = 43
	ChargingSessionAttrEVDepartureTime                 uint16 = 44
	ChargingSessionAttrEVMinDischargingRequest         uint16 = 50
	ChargingSessionAttrEVMaxDischargingRequest         uint16 = 51
	ChargingSessionAttrEVDischargeBelowTargetPermitted uint16 = 52
	ChargingSessionAttrEstimatedTimeToMinSoC           uint16 = 60
	ChargingSessionAttrEstimatedTimeToTargetSoC        uint16 = 61
	ChargingSessionAttrEstimatedTimeToFullSoC          uint16 = 62
	ChargingSessionAttrChargingMode                    uint16 = 70
	ChargingSessionAttrSupportedChargingModes          uint16 = 71
	ChargingSessionAttrSurplusThreshold                uint16 = 72
	ChargingSessionAttrStartDelay                      uint16 = 80
	ChargingSessionAttrStopDelay                       uint16 = 81
)

// ChargingSessionFeatureRevision is the current revision of the ChargingSession feature.
const ChargingSessionFeatureRevision uint16 = 1

// ChargingState represents eV charging state.
type ChargingState uint8

const (
	ChargingStateNotPluggedIn         ChargingState = 0x00
	ChargingStatePluggedInNoDemand    ChargingState = 0x01
	ChargingStatePluggedInDemand      ChargingState = 0x02
	ChargingStatePluggedInCharging    ChargingState = 0x03
	ChargingStatePluggedInDischarging ChargingState = 0x04
	ChargingStateSessionComplete      ChargingState = 0x05
	ChargingStateFault                ChargingState = 0x06
)

// String returns the chargingState name.
func (v ChargingState) String() string {
	switch v {
	case ChargingStateNotPluggedIn:
		return "NOT_PLUGGED_IN"
	case ChargingStatePluggedInNoDemand:
		return "PLUGGED_IN_NO_DEMAND"
	case ChargingStatePluggedInDemand:
		return "PLUGGED_IN_DEMAND"
	case ChargingStatePluggedInCharging:
		return "PLUGGED_IN_CHARGING"
	case ChargingStatePluggedInDischarging:
		return "PLUGGED_IN_DISCHARGING"
	case ChargingStateSessionComplete:
		return "SESSION_COMPLETE"
	case ChargingStateFault:
		return "FAULT"
	default:
		return "UNKNOWN"
	}
}

// EVDemandMode represents eV demand information mode.
type EVDemandMode uint8

const (
	EVDemandModeNone                 EVDemandMode = 0x00
	EVDemandModeSingleDemand         EVDemandMode = 0x01
	EVDemandModeScheduled            EVDemandMode = 0x02
	EVDemandModeDynamic              EVDemandMode = 0x03
	EVDemandModeDynamicBidirectional EVDemandMode = 0x04
)

// String returns the eVDemandMode name.
func (v EVDemandMode) String() string {
	switch v {
	case EVDemandModeNone:
		return "NONE"
	case EVDemandModeSingleDemand:
		return "SINGLE_DEMAND"
	case EVDemandModeScheduled:
		return "SCHEDULED"
	case EVDemandModeDynamic:
		return "DYNAMIC"
	case EVDemandModeDynamicBidirectional:
		return "DYNAMIC_BIDIRECTIONAL"
	default:
		return "UNKNOWN"
	}
}

// EVIDType represents type of EV identification.
type EVIDType uint8

const (
	EVIDTypePCID       EVIDType = 0x00
	EVIDTypeMACEUI48   EVIDType = 0x01
	EVIDTypeMACEUI64   EVIDType = 0x02
	EVIDTypeRFID       EVIDType = 0x03
	EVIDTypeVIN        EVIDType = 0x04
	EVIDTypeContractID EVIDType = 0x05
	EVIDTypeEVCCID     EVIDType = 0x06
	EVIDTypeOther      EVIDType = 0xFF
)

// String returns the eVIDType name.
func (v EVIDType) String() string {
	switch v {
	case EVIDTypePCID:
		return "PCID"
	case EVIDTypeMACEUI48:
		return "MAC_EUI48"
	case EVIDTypeMACEUI64:
		return "MAC_EUI64"
	case EVIDTypeRFID:
		return "RFID"
	case EVIDTypeVIN:
		return "VIN"
	case EVIDTypeContractID:
		return "CONTRACT_ID"
	case EVIDTypeEVCCID:
		return "EVCC_ID"
	case EVIDTypeOther:
		return "OTHER"
	default:
		return "UNKNOWN"
	}
}

// ChargingMode represents charging optimization strategy.
type ChargingMode uint8

const (
	ChargingModeOff                ChargingMode = 0x00
	ChargingModePVSurplusOnly      ChargingMode = 0x01
	ChargingModePVSurplusThreshold ChargingMode = 0x02
	ChargingModePriceOptimized     ChargingMode = 0x03
	ChargingModeScheduled          ChargingMode = 0x04
)

// String returns the chargingMode name.
func (v ChargingMode) String() string {
	switch v {
	case ChargingModeOff:
		return "OFF"
	case ChargingModePVSurplusOnly:
		return "PV_SURPLUS_ONLY"
	case ChargingModePVSurplusThreshold:
		return "PV_SURPLUS_THRESHOLD"
	case ChargingModePriceOptimized:
		return "PRICE_OPTIMIZED"
	case ChargingModeScheduled:
		return "SCHEDULED"
	default:
		return "UNKNOWN"
	}
}

// EVIdentification represents an item in the evIdentifications array.
type EVIdentification struct {
	Type  EVIDType
	Value string
}

// ChargingSession wraps a Feature with ChargingSession-specific functionality.
// EV charging session management, demands, and optimization.
type ChargingSession struct {
	*model.Feature
	onSetChargingMode func(ctx context.Context, req SetChargingModeRequest) error
}

// NewChargingSession creates a new ChargingSession feature.
func NewChargingSession() *ChargingSession {
	f := model.NewFeature(model.FeatureChargingSession, ChargingSessionFeatureRevision)

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrState,
		Name:        "state",
		Type:        model.DataTypeUint8,
		Access:      model.AccessReadOnly,
		Default:     uint8(ChargingStateNotPluggedIn),
		Description: "Current charging state",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrSessionID,
		Name:        "sessionId",
		Type:        model.DataTypeUint32,
		Access:      model.AccessReadOnly,
		Default:     uint32(0),
		Description: "Unique session identifier",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrSessionStartTime,
		Name:        "sessionStartTime",
		Type:        model.DataTypeUint64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Description: "Timestamp when EV connected",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrSessionEndTime,
		Name:        "sessionEndTime",
		Type:        model.DataTypeUint64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Description: "Timestamp when session ended",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrSessionEnergyCharged,
		Name:        "sessionEnergyCharged",
		Type:        model.DataTypeUint64,
		Access:      model.AccessReadOnly,
		Default:     uint64(0),
		Unit:        "mWh",
		Description: "Energy delivered to EV this session",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrSessionEnergyDischarged,
		Name:        "sessionEnergyDischarged",
		Type:        model.DataTypeUint64,
		Access:      model.AccessReadOnly,
		Default:     uint64(0),
		Unit:        "mWh",
		Description: "Energy returned from EV (V2G) this session",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVIdentifications,
		Name:        "evIdentifications",
		Type:        model.DataTypeArray,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Description: "List of EV identifiers",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVStateOfCharge,
		Name:        "evStateOfCharge",
		Type:        model.DataTypeUint8,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "%",
		Description: "Current EV state of charge",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVBatteryCapacity,
		Name:        "evBatteryCapacity",
		Type:        model.DataTypeUint64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "mWh",
		Description: "EV battery capacity",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVMinStateOfCharge,
		Name:        "evMinStateOfCharge",
		Type:        model.DataTypeUint8,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "%",
		Description: "Minimum SoC to charge ASAP",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVTargetStateOfCharge,
		Name:        "evTargetStateOfCharge",
		Type:        model.DataTypeUint8,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "%",
		Description: "User-defined target SoC",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVDemandMode,
		Name:        "evDemandMode",
		Type:        model.DataTypeUint8,
		Access:      model.AccessReadOnly,
		Default:     uint8(EVDemandModeNone),
		Description: "EV demand information mode",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVMinEnergyRequest,
		Name:        "evMinEnergyRequest",
		Type:        model.DataTypeInt64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "mWh",
		Description: "Energy to minimum SoC (negative=can discharge)",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVMaxEnergyRequest,
		Name:        "evMaxEnergyRequest",
		Type:        model.DataTypeInt64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "mWh",
		Description: "Energy to full charge",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVTargetEnergyRequest,
		Name:        "evTargetEnergyRequest",
		Type:        model.DataTypeInt64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "mWh",
		Description: "Energy to target SoC",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVDepartureTime,
		Name:        "evDepartureTime",
		Type:        model.DataTypeUint64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Description: "Timestamp when EV needs to leave",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVMinDischargingRequest,
		Name:        "evMinDischargingRequest",
		Type:        model.DataTypeInt64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "mWh",
		Description: "Minimum discharge limit (must be <0)",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVMaxDischargingRequest,
		Name:        "evMaxDischargingRequest",
		Type:        model.DataTypeInt64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "mWh",
		Description: "Maximum discharge limit (must be >=0)",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEVDischargeBelowTargetPermitted,
		Name:        "evDischargeBelowTargetPermitted",
		Type:        model.DataTypeBool,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Description: "Allow V2G below target SoC",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEstimatedTimeToMinSoC,
		Name:        "estimatedTimeToMinSoC",
		Type:        model.DataTypeUint32,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "s",
		Description: "Estimated time to reach minimum SoC",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEstimatedTimeToTargetSoC,
		Name:        "estimatedTimeToTargetSoC",
		Type:        model.DataTypeUint32,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "s",
		Description: "Estimated time to reach target SoC",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrEstimatedTimeToFullSoC,
		Name:        "estimatedTimeToFullSoC",
		Type:        model.DataTypeUint32,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "s",
		Description: "Estimated time to full charge",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrChargingMode,
		Name:        "chargingMode",
		Type:        model.DataTypeUint8,
		Access:      model.AccessReadOnly,
		Default:     uint8(ChargingModeOff),
		Description: "Active optimization strategy",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrSupportedChargingModes,
		Name:        "supportedChargingModes",
		Type:        model.DataTypeArray,
		Access:      model.AccessReadOnly,
		Description: "Optimization modes EVSE supports",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrSurplusThreshold,
		Name:        "surplusThreshold",
		Type:        model.DataTypeInt64,
		Access:      model.AccessReadOnly,
		Nullable:    true,
		Unit:        "mW",
		Description: "Threshold for PV_SURPLUS_THRESHOLD mode",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrStartDelay,
		Name:        "startDelay",
		Type:        model.DataTypeUint32,
		Access:      model.AccessReadOnly,
		Default:     uint32(0),
		Unit:        "s",
		Description: "Delay before (re)starting charge",
	}))

	f.AddAttribute(model.NewAttribute(&model.AttributeMetadata{
		ID:          ChargingSessionAttrStopDelay,
		Name:        "stopDelay",
		Type:        model.DataTypeUint32,
		Access:      model.AccessReadOnly,
		Default:     uint32(0),
		Unit:        "s",
		Description: "Delay before pausing charge",
	}))

	c := &ChargingSession{Feature: f}
	c.addCommands()

	return c
}

// State returns the current charging state.
func (c *ChargingSession) State() ChargingState {
	val, _ := c.ReadAttribute(ChargingSessionAttrState)
	if v, ok := val.(uint8); ok {
		return ChargingState(v)
	}
	return ChargingStateNotPluggedIn
}

// SessionID returns the unique session identifier.
func (c *ChargingSession) SessionID() uint32 {
	val, _ := c.ReadAttribute(ChargingSessionAttrSessionID)
	if v, ok := val.(uint32); ok {
		return v
	}
	return uint32(0)
}

// SessionStartTime returns the timestamp when EV connected.
func (c *ChargingSession) SessionStartTime() (uint64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrSessionStartTime)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint64); ok {
		return v, true
	}
	return 0, false
}

// SessionEndTime returns the timestamp when session ended.
func (c *ChargingSession) SessionEndTime() (uint64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrSessionEndTime)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint64); ok {
		return v, true
	}
	return 0, false
}

// SessionEnergyCharged returns the energy delivered to EV this session.
func (c *ChargingSession) SessionEnergyCharged() uint64 {
	val, _ := c.ReadAttribute(ChargingSessionAttrSessionEnergyCharged)
	if v, ok := val.(uint64); ok {
		return v
	}
	return uint64(0)
}

// SessionEnergyDischarged returns the energy returned from EV (V2G) this session.
func (c *ChargingSession) SessionEnergyDischarged() uint64 {
	val, _ := c.ReadAttribute(ChargingSessionAttrSessionEnergyDischarged)
	if v, ok := val.(uint64); ok {
		return v
	}
	return uint64(0)
}

// EVIdentifications returns the list of EV identifiers.
func (c *ChargingSession) EVIdentifications() ([]EVIdentification, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVIdentifications)
	if err != nil || val == nil {
		return nil, false
	}
	raw, ok := val.([]any)
	if !ok {
		return nil, false
	}
	result := make([]EVIdentification, 0, len(raw))
	for _, item := range raw {
		m, ok := item.(map[string]any)
		if !ok {
			continue
		}
		entry := EVIdentification{}
		if v, ok := m["type"]; ok {
			if n, ok := v.(uint8); ok {
				entry.Type = EVIDType(n)
			}
		}
		if v, ok := m["value"]; ok {
			if n, ok := v.(string); ok {
				entry.Value = n
			}
		}
		result = append(result, entry)
	}
	return result, true
}

// EVStateOfCharge returns the current EV state of charge.
func (c *ChargingSession) EVStateOfCharge() (uint8, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVStateOfCharge)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint8); ok {
		return v, true
	}
	return 0, false
}

// EVBatteryCapacity returns the eV battery capacity.
func (c *ChargingSession) EVBatteryCapacity() (uint64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVBatteryCapacity)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint64); ok {
		return v, true
	}
	return 0, false
}

// EVMinStateOfCharge returns the minimum SoC to charge ASAP.
func (c *ChargingSession) EVMinStateOfCharge() (uint8, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVMinStateOfCharge)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint8); ok {
		return v, true
	}
	return 0, false
}

// EVTargetStateOfCharge returns the user-defined target SoC.
func (c *ChargingSession) EVTargetStateOfCharge() (uint8, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVTargetStateOfCharge)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint8); ok {
		return v, true
	}
	return 0, false
}

// EVDemandMode returns the eV demand information mode.
func (c *ChargingSession) EVDemandMode() EVDemandMode {
	val, _ := c.ReadAttribute(ChargingSessionAttrEVDemandMode)
	if v, ok := val.(uint8); ok {
		return EVDemandMode(v)
	}
	return EVDemandModeNone
}

// EVMinEnergyRequest returns the energy to minimum SoC (negative=can discharge).
func (c *ChargingSession) EVMinEnergyRequest() (int64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVMinEnergyRequest)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(int64); ok {
		return v, true
	}
	return 0, false
}

// EVMaxEnergyRequest returns the energy to full charge.
func (c *ChargingSession) EVMaxEnergyRequest() (int64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVMaxEnergyRequest)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(int64); ok {
		return v, true
	}
	return 0, false
}

// EVTargetEnergyRequest returns the energy to target SoC.
func (c *ChargingSession) EVTargetEnergyRequest() (int64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVTargetEnergyRequest)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(int64); ok {
		return v, true
	}
	return 0, false
}

// EVDepartureTime returns the timestamp when EV needs to leave.
func (c *ChargingSession) EVDepartureTime() (uint64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVDepartureTime)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint64); ok {
		return v, true
	}
	return 0, false
}

// EVMinDischargingRequest returns the minimum discharge limit (must be <0).
func (c *ChargingSession) EVMinDischargingRequest() (int64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVMinDischargingRequest)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(int64); ok {
		return v, true
	}
	return 0, false
}

// EVMaxDischargingRequest returns the maximum discharge limit (must be >=0).
func (c *ChargingSession) EVMaxDischargingRequest() (int64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVMaxDischargingRequest)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(int64); ok {
		return v, true
	}
	return 0, false
}

// EVDischargeBelowTargetPermitted returns the allow V2G below target SoC.
func (c *ChargingSession) EVDischargeBelowTargetPermitted() (bool, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEVDischargeBelowTargetPermitted)
	if err != nil || val == nil {
		return false, false
	}
	if v, ok := val.(bool); ok {
		return v, true
	}
	return false, false
}

// EstimatedTimeToMinSoC returns the estimated time to reach minimum SoC.
func (c *ChargingSession) EstimatedTimeToMinSoC() (uint32, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEstimatedTimeToMinSoC)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint32); ok {
		return v, true
	}
	return 0, false
}

// EstimatedTimeToTargetSoC returns the estimated time to reach target SoC.
func (c *ChargingSession) EstimatedTimeToTargetSoC() (uint32, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEstimatedTimeToTargetSoC)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint32); ok {
		return v, true
	}
	return 0, false
}

// EstimatedTimeToFullSoC returns the estimated time to full charge.
func (c *ChargingSession) EstimatedTimeToFullSoC() (uint32, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrEstimatedTimeToFullSoC)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(uint32); ok {
		return v, true
	}
	return 0, false
}

// ChargingMode returns the active optimization strategy.
func (c *ChargingSession) ChargingMode() ChargingMode {
	val, _ := c.ReadAttribute(ChargingSessionAttrChargingMode)
	if v, ok := val.(uint8); ok {
		return ChargingMode(v)
	}
	return ChargingModeOff
}

// SupportedChargingModes returns the optimization modes EVSE supports.
func (c *ChargingSession) SupportedChargingModes() ([]ChargingMode, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrSupportedChargingModes)
	if err != nil || val == nil {
		return nil, false
	}
	raw, ok := val.([]any)
	if !ok {
		return nil, false
	}
	result := make([]ChargingMode, 0, len(raw))
	for _, item := range raw {
		if v, ok := item.(uint8); ok {
			result = append(result, ChargingMode(v))
		}
	}
	return result, true
}

// SurplusThreshold returns the threshold for PV_SURPLUS_THRESHOLD mode.
func (c *ChargingSession) SurplusThreshold() (int64, bool) {
	val, err := c.ReadAttribute(ChargingSessionAttrSurplusThreshold)
	if err != nil || val == nil {
		return 0, false
	}
	if v, ok := val.(int64); ok {
		return v, true
	}
	return 0, false
}

// StartDelay returns the delay before (re)starting charge.
func (c *ChargingSession) StartDelay() uint32 {
	val, _ := c.ReadAttribute(ChargingSessionAttrStartDelay)
	if v, ok := val.(uint32); ok {
		return v
	}
	return uint32(0)
}

// StopDelay returns the delay before pausing charge.
func (c *ChargingSession) StopDelay() uint32 {
	val, _ := c.ReadAttribute(ChargingSessionAttrStopDelay)
	if v, ok := val.(uint32); ok {
		return v
	}
	return uint32(0)
}

// SetState sets the current charging state.
func (c *ChargingSession) SetState(state ChargingState) error {
	attr, err := c.GetAttribute(ChargingSessionAttrState)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(uint8(state))
}

// SetSessionID sets the unique session identifier.
func (c *ChargingSession) SetSessionID(sessionId uint32) error {
	attr, err := c.GetAttribute(ChargingSessionAttrSessionID)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(sessionId)
}

// SetSessionStartTime sets the timestamp when EV connected.
func (c *ChargingSession) SetSessionStartTime(sessionStartTime uint64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrSessionStartTime)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(sessionStartTime)
}

// ClearSessionStartTime clears the timestamp when EV connected.
func (c *ChargingSession) ClearSessionStartTime() error {
	attr, err := c.GetAttribute(ChargingSessionAttrSessionStartTime)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetSessionStartTimePtr sets or clears the timestamp when EV connected from a pointer.
func (c *ChargingSession) SetSessionStartTimePtr(v *uint64) error {
	if v == nil {
		return c.ClearSessionStartTime()
	}
	return c.SetSessionStartTime(*v)
}

// SetSessionEndTime sets the timestamp when session ended.
func (c *ChargingSession) SetSessionEndTime(sessionEndTime uint64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrSessionEndTime)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(sessionEndTime)
}

// ClearSessionEndTime clears the timestamp when session ended.
func (c *ChargingSession) ClearSessionEndTime() error {
	attr, err := c.GetAttribute(ChargingSessionAttrSessionEndTime)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetSessionEndTimePtr sets or clears the timestamp when session ended from a pointer.
func (c *ChargingSession) SetSessionEndTimePtr(v *uint64) error {
	if v == nil {
		return c.ClearSessionEndTime()
	}
	return c.SetSessionEndTime(*v)
}

// SetSessionEnergyCharged sets the energy delivered to EV this session.
func (c *ChargingSession) SetSessionEnergyCharged(sessionEnergyCharged uint64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrSessionEnergyCharged)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(sessionEnergyCharged)
}

// SetSessionEnergyDischarged sets the energy returned from EV (V2G) this session.
func (c *ChargingSession) SetSessionEnergyDischarged(sessionEnergyDischarged uint64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrSessionEnergyDischarged)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(sessionEnergyDischarged)
}

// SetEVIdentifications sets the list of EV identifiers.
func (c *ChargingSession) SetEVIdentifications(evIdentifications []EVIdentification) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVIdentifications)
	if err != nil {
		return err
	}
	if evIdentifications == nil {
		return attr.SetValueInternal(nil)
	}
	data := make([]map[string]any, len(evIdentifications))
	for i, item := range evIdentifications {
		data[i] = map[string]any{
			"type":  uint8(item.Type),
			"value": item.Value,
		}
	}
	return attr.SetValueInternal(data)
}

// ClearEVIdentifications clears the list of EV identifiers.
func (c *ChargingSession) ClearEVIdentifications() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVIdentifications)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVStateOfCharge sets the current EV state of charge.
func (c *ChargingSession) SetEVStateOfCharge(evStateOfCharge uint8) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVStateOfCharge)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evStateOfCharge)
}

// ClearEVStateOfCharge clears the current EV state of charge.
func (c *ChargingSession) ClearEVStateOfCharge() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVStateOfCharge)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVStateOfChargePtr sets or clears the current EV state of charge from a pointer.
func (c *ChargingSession) SetEVStateOfChargePtr(v *uint8) error {
	if v == nil {
		return c.ClearEVStateOfCharge()
	}
	return c.SetEVStateOfCharge(*v)
}

// SetEVBatteryCapacity sets the eV battery capacity.
func (c *ChargingSession) SetEVBatteryCapacity(evBatteryCapacity uint64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVBatteryCapacity)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evBatteryCapacity)
}

// ClearEVBatteryCapacity clears the eV battery capacity.
func (c *ChargingSession) ClearEVBatteryCapacity() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVBatteryCapacity)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVBatteryCapacityPtr sets or clears the eV battery capacity from a pointer.
func (c *ChargingSession) SetEVBatteryCapacityPtr(v *uint64) error {
	if v == nil {
		return c.ClearEVBatteryCapacity()
	}
	return c.SetEVBatteryCapacity(*v)
}

// SetEVMinStateOfCharge sets the minimum SoC to charge ASAP.
func (c *ChargingSession) SetEVMinStateOfCharge(evMinStateOfCharge uint8) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMinStateOfCharge)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evMinStateOfCharge)
}

// ClearEVMinStateOfCharge clears the minimum SoC to charge ASAP.
func (c *ChargingSession) ClearEVMinStateOfCharge() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMinStateOfCharge)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVMinStateOfChargePtr sets or clears the minimum SoC to charge ASAP from a pointer.
func (c *ChargingSession) SetEVMinStateOfChargePtr(v *uint8) error {
	if v == nil {
		return c.ClearEVMinStateOfCharge()
	}
	return c.SetEVMinStateOfCharge(*v)
}

// SetEVTargetStateOfCharge sets the user-defined target SoC.
func (c *ChargingSession) SetEVTargetStateOfCharge(evTargetStateOfCharge uint8) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVTargetStateOfCharge)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evTargetStateOfCharge)
}

// ClearEVTargetStateOfCharge clears the user-defined target SoC.
func (c *ChargingSession) ClearEVTargetStateOfCharge() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVTargetStateOfCharge)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVTargetStateOfChargePtr sets or clears the user-defined target SoC from a pointer.
func (c *ChargingSession) SetEVTargetStateOfChargePtr(v *uint8) error {
	if v == nil {
		return c.ClearEVTargetStateOfCharge()
	}
	return c.SetEVTargetStateOfCharge(*v)
}

// SetEVDemandMode sets the eV demand information mode.
func (c *ChargingSession) SetEVDemandMode(evDemandMode EVDemandMode) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVDemandMode)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(uint8(evDemandMode))
}

// SetEVMinEnergyRequest sets the energy to minimum SoC (negative=can discharge).
func (c *ChargingSession) SetEVMinEnergyRequest(evMinEnergyRequest int64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMinEnergyRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evMinEnergyRequest)
}

// ClearEVMinEnergyRequest clears the energy to minimum SoC (negative=can discharge).
func (c *ChargingSession) ClearEVMinEnergyRequest() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMinEnergyRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVMinEnergyRequestPtr sets or clears the energy to minimum SoC (negative=can discharge) from a pointer.
func (c *ChargingSession) SetEVMinEnergyRequestPtr(v *int64) error {
	if v == nil {
		return c.ClearEVMinEnergyRequest()
	}
	return c.SetEVMinEnergyRequest(*v)
}

// SetEVMaxEnergyRequest sets the energy to full charge.
func (c *ChargingSession) SetEVMaxEnergyRequest(evMaxEnergyRequest int64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMaxEnergyRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evMaxEnergyRequest)
}

// ClearEVMaxEnergyRequest clears the energy to full charge.
func (c *ChargingSession) ClearEVMaxEnergyRequest() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMaxEnergyRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVMaxEnergyRequestPtr sets or clears the energy to full charge from a pointer.
func (c *ChargingSession) SetEVMaxEnergyRequestPtr(v *int64) error {
	if v == nil {
		return c.ClearEVMaxEnergyRequest()
	}
	return c.SetEVMaxEnergyRequest(*v)
}

// SetEVTargetEnergyRequest sets the energy to target SoC.
func (c *ChargingSession) SetEVTargetEnergyRequest(evTargetEnergyRequest int64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVTargetEnergyRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evTargetEnergyRequest)
}

// ClearEVTargetEnergyRequest clears the energy to target SoC.
func (c *ChargingSession) ClearEVTargetEnergyRequest() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVTargetEnergyRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVTargetEnergyRequestPtr sets or clears the energy to target SoC from a pointer.
func (c *ChargingSession) SetEVTargetEnergyRequestPtr(v *int64) error {
	if v == nil {
		return c.ClearEVTargetEnergyRequest()
	}
	return c.SetEVTargetEnergyRequest(*v)
}

// SetEVDepartureTime sets the timestamp when EV needs to leave.
func (c *ChargingSession) SetEVDepartureTime(evDepartureTime uint64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVDepartureTime)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evDepartureTime)
}

// ClearEVDepartureTime clears the timestamp when EV needs to leave.
func (c *ChargingSession) ClearEVDepartureTime() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVDepartureTime)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVDepartureTimePtr sets or clears the timestamp when EV needs to leave from a pointer.
func (c *ChargingSession) SetEVDepartureTimePtr(v *uint64) error {
	if v == nil {
		return c.ClearEVDepartureTime()
	}
	return c.SetEVDepartureTime(*v)
}

// SetEVMinDischargingRequest sets the minimum discharge limit (must be <0).
func (c *ChargingSession) SetEVMinDischargingRequest(evMinDischargingRequest int64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMinDischargingRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evMinDischargingRequest)
}

// ClearEVMinDischargingRequest clears the minimum discharge limit (must be <0).
func (c *ChargingSession) ClearEVMinDischargingRequest() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMinDischargingRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVMinDischargingRequestPtr sets or clears the minimum discharge limit (must be <0) from a pointer.
func (c *ChargingSession) SetEVMinDischargingRequestPtr(v *int64) error {
	if v == nil {
		return c.ClearEVMinDischargingRequest()
	}
	return c.SetEVMinDischargingRequest(*v)
}

// SetEVMaxDischargingRequest sets the maximum discharge limit (must be >=0).
func (c *ChargingSession) SetEVMaxDischargingRequest(evMaxDischargingRequest int64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMaxDischargingRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evMaxDischargingRequest)
}

// ClearEVMaxDischargingRequest clears the maximum discharge limit (must be >=0).
func (c *ChargingSession) ClearEVMaxDischargingRequest() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVMaxDischargingRequest)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVMaxDischargingRequestPtr sets or clears the maximum discharge limit (must be >=0) from a pointer.
func (c *ChargingSession) SetEVMaxDischargingRequestPtr(v *int64) error {
	if v == nil {
		return c.ClearEVMaxDischargingRequest()
	}
	return c.SetEVMaxDischargingRequest(*v)
}

// SetEVDischargeBelowTargetPermitted sets the allow V2G below target SoC.
func (c *ChargingSession) SetEVDischargeBelowTargetPermitted(evDischargeBelowTargetPermitted bool) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVDischargeBelowTargetPermitted)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(evDischargeBelowTargetPermitted)
}

// ClearEVDischargeBelowTargetPermitted clears the allow V2G below target SoC.
func (c *ChargingSession) ClearEVDischargeBelowTargetPermitted() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEVDischargeBelowTargetPermitted)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEVDischargeBelowTargetPermittedPtr sets or clears the allow V2G below target SoC from a pointer.
func (c *ChargingSession) SetEVDischargeBelowTargetPermittedPtr(v *bool) error {
	if v == nil {
		return c.ClearEVDischargeBelowTargetPermitted()
	}
	return c.SetEVDischargeBelowTargetPermitted(*v)
}

// SetEstimatedTimeToMinSoC sets the estimated time to reach minimum SoC.
func (c *ChargingSession) SetEstimatedTimeToMinSoC(estimatedTimeToMinSoC uint32) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEstimatedTimeToMinSoC)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(estimatedTimeToMinSoC)
}

// ClearEstimatedTimeToMinSoC clears the estimated time to reach minimum SoC.
func (c *ChargingSession) ClearEstimatedTimeToMinSoC() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEstimatedTimeToMinSoC)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEstimatedTimeToMinSoCPtr sets or clears the estimated time to reach minimum SoC from a pointer.
func (c *ChargingSession) SetEstimatedTimeToMinSoCPtr(v *uint32) error {
	if v == nil {
		return c.ClearEstimatedTimeToMinSoC()
	}
	return c.SetEstimatedTimeToMinSoC(*v)
}

// SetEstimatedTimeToTargetSoC sets the estimated time to reach target SoC.
func (c *ChargingSession) SetEstimatedTimeToTargetSoC(estimatedTimeToTargetSoC uint32) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEstimatedTimeToTargetSoC)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(estimatedTimeToTargetSoC)
}

// ClearEstimatedTimeToTargetSoC clears the estimated time to reach target SoC.
func (c *ChargingSession) ClearEstimatedTimeToTargetSoC() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEstimatedTimeToTargetSoC)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEstimatedTimeToTargetSoCPtr sets or clears the estimated time to reach target SoC from a pointer.
func (c *ChargingSession) SetEstimatedTimeToTargetSoCPtr(v *uint32) error {
	if v == nil {
		return c.ClearEstimatedTimeToTargetSoC()
	}
	return c.SetEstimatedTimeToTargetSoC(*v)
}

// SetEstimatedTimeToFullSoC sets the estimated time to full charge.
func (c *ChargingSession) SetEstimatedTimeToFullSoC(estimatedTimeToFullSoC uint32) error {
	attr, err := c.GetAttribute(ChargingSessionAttrEstimatedTimeToFullSoC)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(estimatedTimeToFullSoC)
}

// ClearEstimatedTimeToFullSoC clears the estimated time to full charge.
func (c *ChargingSession) ClearEstimatedTimeToFullSoC() error {
	attr, err := c.GetAttribute(ChargingSessionAttrEstimatedTimeToFullSoC)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetEstimatedTimeToFullSoCPtr sets or clears the estimated time to full charge from a pointer.
func (c *ChargingSession) SetEstimatedTimeToFullSoCPtr(v *uint32) error {
	if v == nil {
		return c.ClearEstimatedTimeToFullSoC()
	}
	return c.SetEstimatedTimeToFullSoC(*v)
}

// SetChargingMode sets the active optimization strategy.
func (c *ChargingSession) SetChargingMode(chargingMode ChargingMode) error {
	attr, err := c.GetAttribute(ChargingSessionAttrChargingMode)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(uint8(chargingMode))
}

// SetSupportedChargingModes sets the optimization modes EVSE supports.
func (c *ChargingSession) SetSupportedChargingModes(supportedChargingModes []ChargingMode) error {
	attr, err := c.GetAttribute(ChargingSessionAttrSupportedChargingModes)
	if err != nil {
		return err
	}
	data := make([]uint8, len(supportedChargingModes))
	for i, v := range supportedChargingModes {
		data[i] = uint8(v)
	}
	return attr.SetValueInternal(data)
}

// SetSurplusThreshold sets the threshold for PV_SURPLUS_THRESHOLD mode.
func (c *ChargingSession) SetSurplusThreshold(surplusThreshold int64) error {
	attr, err := c.GetAttribute(ChargingSessionAttrSurplusThreshold)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(surplusThreshold)
}

// ClearSurplusThreshold clears the threshold for PV_SURPLUS_THRESHOLD mode.
func (c *ChargingSession) ClearSurplusThreshold() error {
	attr, err := c.GetAttribute(ChargingSessionAttrSurplusThreshold)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(nil)
}

// SetSurplusThresholdPtr sets or clears the threshold for PV_SURPLUS_THRESHOLD mode from a pointer.
func (c *ChargingSession) SetSurplusThresholdPtr(v *int64) error {
	if v == nil {
		return c.ClearSurplusThreshold()
	}
	return c.SetSurplusThreshold(*v)
}

// SetStartDelay sets the delay before (re)starting charge.
func (c *ChargingSession) SetStartDelay(startDelay uint32) error {
	attr, err := c.GetAttribute(ChargingSessionAttrStartDelay)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(startDelay)
}

// SetStopDelay sets the delay before pausing charge.
func (c *ChargingSession) SetStopDelay(stopDelay uint32) error {
	attr, err := c.GetAttribute(ChargingSessionAttrStopDelay)
	if err != nil {
		return err
	}
	return attr.SetValueInternal(stopDelay)
}

// ChargingSession command IDs.
const (
	ChargingSessionCmdSetChargingMode uint8 = 1
)

// SetChargingModeRequest represents the setChargingMode command parameters.
type SetChargingModeRequest struct {
	Mode             ChargingMode
	SurplusThreshold *int64
	StartDelay       *uint32
	StopDelay        *uint32
}

// addCommands adds the ChargingSession commands.
func (c *ChargingSession) addCommands() {
	c.AddCommand(model.NewCommand(&model.CommandMetadata{
		ID:          ChargingSessionCmdSetChargingMode,
		Name:        "setChargingMode",
		Description: "Set the optimization strategy",
		Parameters: []model.ParameterMetadata{
			{Name: "mode", Type: model.DataTypeUint8, Required: true},
			{Name: "surplusThreshold", Type: model.DataTypeInt64, Required: false},
			{Name: "startDelay", Type: model.DataTypeUint32, Required: false},
			{Name: "stopDelay", Type: model.DataTypeUint32, Required: false},
		},
	}, c.handleSetChargingMode))

}

func (c *ChargingSession) handleSetChargingMode(ctx context.Context, params map[string]any) (map[string]any, error) {
	if c.onSetChargingMode == nil {
		return map[string]any{"success": false}, nil
	}

	req := SetChargingModeRequest{}
	if raw, exists := params["mode"]; exists {
		if v, ok := wire.ToUint8Public(raw); ok {
			req.Mode = ChargingMode(v)
		}
	}
	if raw, exists := params["surplusThreshold"]; exists {
		if v, ok := wire.ToInt64(raw); ok {
			req.SurplusThreshold = &v
		}
	}
	if raw, exists := params["startDelay"]; exists {
		if v, ok := wire.ToUint32(raw); ok {
			req.StartDelay = &v
		}
	}
	if raw, exists := params["stopDelay"]; exists {
		if v, ok := wire.ToUint32(raw); ok {
			req.StopDelay = &v
		}
	}

	err := c.onSetChargingMode(ctx, req)
	return map[string]any{"success": err == nil}, err
}

// OnSetChargingMode sets the handler for setChargingMode command.
func (c *ChargingSession) OnSetChargingMode(handler func(ctx context.Context, req SetChargingModeRequest) error) {
	c.onSetChargingMode = handler
}
